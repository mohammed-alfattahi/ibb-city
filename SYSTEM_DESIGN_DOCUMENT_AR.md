# الفصل الثالث: تحليل وتصميم النظام (System Analysis & Design)

## 1.3 المقدمة (Introduction)
تعني مرحلة التحليل دراسة متطلبات النظام وتحديدها وتوصيفها، وذلك من خلال وضع المتطلبات والمعايير اللازمة لعملية التطوير، بالإضافة إلى التعرف على متطلبات النظام الوظيفية وغير الوظيفية، والقيود الأخرى التي يخضع لها النظام. يُنفذ التحليل بواسطة مطوري ومحللي الأنظمة، حيث يقومون بدراسة التطبيق الحالي بدقة في حال وجود نظام سابق، وجمع المتطلبات من أصحاب المصلحة. تعتبر عملية جمع المعلومات حاسمة لنجاح أي مشروع. وبالتالي، يمكننا تحديد أن عملية التحليل تهتم بتمثيل العمليات على هيئة مخططات تُسهِّل التعرف عليها بشكل أفضل. من بين المخططات التي تم نمذجتها في هذا الفصل: مخطط العمليات، المخطط البيئي، مخطط الكيانات والعلاقات (ERD)، مخطط حالات الاستخدام (Use Case)، ومخطط الفئات (Class Diagram)، بالإضافة إلى جداول قاعدة البيانات.

---

## 2.3 طرق جمع المعلومات (Information Collection Methods)
تُعَدُّ عملية جمع المعلومات خطوة أساسية في أي مشروع بحثي. في مشروعنا حول تطوير نظام إلكتروني (خادم- عميل) لتحضير الطلاب بالاعتماد على المصادقة البيومترية، اعتمدنا على طرق مثل المقابلة الشخصية والملاحظة لجمع معلومات دقيقة وشاملة. تهدف هذه الطرق إلى ضمان موثوقية نتائج المشروع وتحليلها بشكل فعال.

### 1.2.3 المقابلة الشخصية (Interview)
تعتبر المقابلة الشخصية من أهم وسائل جمع البيانات وأكثرها فاعلية وبالتالي، فبعد أن قمنا بالتخطيط لإجراء الدراسة وقمنا بتحديد الفريق الذي سيقوم بذلك، قمنا بإجراء المقابلات الشخصية مع الجهات المعنية بالمشروع، وعلى رأسها مكتب السياحة في محافظة إب.
تم تحديد موعد الاجتماع الأول مع مدير مكتب السياحة غانم عوسج ونائبه عبد القادر البخيتي وتم ذلك في تاريخ 2025/11/19 الساعة الرابعة عصراً، وتم الاجتماع في فندق الثلاثين. استمر الاجتماع لمدة ساعتين ونصف من الساعة الرابعة مساءً إلى السادسة ونصف مساءً كما تم تحديد موعد مقابلة أخرى في 26 / نوفمبر / يوم الأربعاء الساعة 3:00 عصراً مع نائب مدير مكتب السياحة عبد القادر البخيتي، واستغرقت هذه المقابلة 3 ساعات.

### 2.2.3 نتائج المقابلة الشخصية (Interview Results)
بعد إجراء عملية المقابلة دار النقاش حول المحاور السابقة وتم التوصل إلى النتائج التالية:
1. **الخرائط التفصيلية**: وجود خرائط توضح أماكن المعالم السياحية والفنادق والمطاعم والمستشفيات.
2. **شبكة الطرق**: وجود بيانات عن الطرقات المؤدية إلى المعالم.
3. **خدمات المرافق**: توفير مواقع المستشفيات والصرافات ومكاتب النقل.
4. **بيانات الخدمات**: توضيح نوع الخدمات التي يوفرها كل معلم من المعالم السياحية.
5. **تفاصيل الخدمات**: مثل المواقف والمياه العامة والإنترنت والحمامات.
6. **الربط والتكامل**: ربط المنصة مع مكاتب السفريات والسياحة.
7. **الربط بين المنصة والنقل**: يربط بين المنصة وشركات النقل والسفريات.
8. **فرص الاستثمار**: أن تتضمن المنصة الأماكن القابلة للاستثمار في المعالم السياحية.
9. **نظام الشكاوى**: وجود ميزة تقديم التقارير والشكاوى للمكتب.
10. **ميزة الإعلانات**: توفير ميزة الإعلانات.
11. **ميزة الاشتراك**: إضافة ميزة الاشتراك في المستقبل.
12. **الموافقة قبل الإضافة**: أخذ موافقة المكتب عند إضافة أي منشأة في المنصة.
13. **منصة موثوقة**: ينبغي وجود منصة سياحية موثوقة تخص قطاع السياحة في محافظة إب.
14. **مواسم الزيارة**: لمعرفة السياح بالمواسم المناسبة لزيارة بعض الأماكن السياحية.
15. **حالة الطريق**: ليعرف الزوار بحالة الطريق وما هي الوسيلة التي يستطيع من خلالها الوصول إلى الموقع السياحي.
16. **طبيعة المكان**: من أجل معرفة السياح بطبيعة المكان السياحي هل يقبل أي شخص (العزاب) أو العوائل.
17. **التبني الرسمي**: تم تبني المشروع من قبل المكتب واعتباره "مشروع رسمي" من قبل الجهات المختصة.
18. **الحصول على البيانات**: تمت الموافقة على الحصول على البيانات المطلوبة وتحديد ما نوع البيان الموجود.
19. **تفويض الدعم**: قدم مدير مكتب السياحة تفويض الولدة جبران غانم عوسج ونائبه عبد القادر البخيتي للمساعدة في النزول الميداني لجمع بقية البيانات.
20. **الترويج للمنصة**: سيتم العمل على عقد مؤتمر على مستوى المحافظة لعرض المشروع للترويج.

---

## 3.3 الدراسة التفصيلية (Detailed Study)
تستعرض الدراسة التفصيلية الآلية التنفيذية والوظيفية للنظام السياحي الذكي، مع تفصيل سيناريوهات التفاعل الرئيسية لكل وحدة (السائح، الشريك، الإدارة). يشمل ذلك إنشاء الحسابات، إدارة المعالم والمنشآت، وتفعيل الخدمات المتقدمة كالملاحة والبلاغات، مع ضمان تكامل البيانات عبر قاعدة البيانات.

### 1.3.3 إنشاء حساب جديد للسائح (Tourist Account Creation)
في عملية تسجيل حساب جديد، يفتح السائح واجهة التسجيل ويدخل البيانات الأساسية (الاسم، الهاتف، البريد، كلمة المرور).
**التسلسل:**
1. **الإدخال والتحقق**: يضغط السائح على زر "تسجيل". يقوم النظام أولاً بفحص صحة تنسيق البيانات (البريد، الهاتف) وقوة كلمة المرور.
2. **التحقق من التكرار**: يرسل النظام استعلام SELECT لجدول Users للتأكد من أن رقم الهاتف أو البريد غير مسجل مسبقاً.
3. **رمز التحقق (OTP)**: في حال عدم التكرار، يولد النظام رمز تحقق فريد (OTP) ويحفظه مؤقتاً في الكاش، ثم يرسله إلى السائح (عبر البريد الإلكتروني أو الرسائل).
4. **المطابقة والحفظ**: يدخل السائح الرمز المُرسل. عند مطابقة الرمز المحفوظ في الكاش، يقوم النظام بتشفير كلمة المرور.
5. **إنشاء السجل**: ينفذ النظام عملية INSERT لإنشاء سجل جديد في جدول Users، مع تحديد Role = 'Tourist' وحالة Status = 'Active'.
6. **تسجيل الدخول**: يتم إنشاء رمز جلسة (Session Token) ويسجل دخول السائح تلقائياً للاستفادة من الخدمات التفاعلية.

### 2.3.3 عرض المعالم السياحية والخدمات المجاورة (Attraction and Nearby Services Display)
تُعد هذه العملية هي جوهر النظام، حيث تُمكن السائح من استكشاف الأماكن ومعرفة ما يحيط بها.
**التسلسل:**
1. **تصفح المعالم**: يختار السائح تصنيفاً محدداً (مثل "طبيعية"). يرسل النظام استعلام SELECT للمعالم المطابقة في جدول Attractions ويحدد حقول (الاسم، الصورة المصغرة، التقييم).
2. **عرض التفاصيل**: يضغط السائح على معلم معين. يرسل النظام طلباً لجلب التفاصيل من جدول Attractions، ويتبعها بطلب متزامن لجلب روابط الوسائط (صور وفيديو) من جدول Media المرتبط.
3. **قراءة الإحداثيات**: يقوم النظام بقراءة إحداثيات المعلم (Latitude, Longitude) المخزنة في جدول Attractions.
4. **الاستعلام المكاني**: عند طلب "الخدمات المجاورة"، يقوم النظام بتنفيذ استعلام مكاني (Geospatial Query) على جدول Facilities لتحديد المنشآت التي تقع ضمن نطاق (مثلاً 1 كم) من إحداثيات المعلم.
5. **عرض النتائج**: يعرض النظام قائمة المنشآت (مطاعم، فنادق) مرتبة حسب نوع الخدمة والمسافة المحسوبة، مع إظهار حالة المنشأة (مفتوح/مغلق) التي جُلبت من جدول Facilities.

### 3.3.3 عملية تقييم المعلم (Rating and Review Submission)
تتيح هذه العملية للسائح التفاعل المباشر مع المعالم السياحية.
**التسلسل:**
1. **التحقق من الحالة**: يضغط السائح على "أضف تقييمك". يتحقق النظام أولاً من رمز الجلسة (Session_ID) للتأكد من أن السائح مسجل دخول.
2. **فلترة المحتوى**: يكتب السائح نص التعليق. يمرر النظام النص إلى Content Filter API للبحث عن أي كلمات مسيئة أو محظورة.
3. **إدراج/تحديث**:
    * إذا كان التعليق سليماً، يحفظ النظام التعليق والنجمات في جدول Reviews مع ربطه بـ User_ID و Attraction_ID.
    * يستخدم النظام دالة (Trigger) أو إجراء مخزن لإعادة حساب المتوسط الحسابي للتقييمات.
4. **تحديث بيانات المعلم**: يقوم النظام بتحديث الحقل Avg_Rating في جدول Attractions بالقيمة الجديدة المحسوبة فورياً.
5. **الإشعارات**: في حال كتابة تعليق (Review) على منشأة شريكة، يرسل النظام إشعاراً فورياً (Push Notification) إلى حساب الشريك لإعلامه بالتعليق.

### 4.3.3 تسجيل واعتماد الشريك التجاري (Partner Registration and Approval)
تتم هذه العملية لدمج المنشآت التجارية في النظام.
**التسلسل:**
1. **إنشاء الحساب الأولي**: يكمل الشريك عملية تسجيل الحساب في جدول Users بدور Role = 'Partner'.
2. **رفع الوثائق**: يملأ الشريك نموذج تسجيل المنشأة ويرفع صور الوثائق (السجل التجاري، الترخيص). يقوم النظام برفع الصور إلى التخزين السحابي وحفظ الروابط في جدول Facilities مع تعيين حالة Approval_Status = 'Pending'.
3. **إشعار المشرف**: يرسل النظام إشعاراً فورياً للوحة تحكم المشرفين يفيد بوجود طلب اعتماد جديد.
4. **مراجعة المشرف (KYC)**: يدخل المشرف إلى لوحته ويستعرض البيانات والوثائق.
5. **القبول/الرفض**:
    * **في حال القبول**: يقوم المشرف بتغيير Approval_Status إلى 'Approved'. يقوم النظام بتفعيل صلاحيات الشريك.
    * **في حال الرفض**: يغير المشرف الحالة إلى 'Rejected' مع إدخال سبب الرفض. يرسل النظام إشعاراً للشريك بالرفض والسبب.

### 5.3.3 إدارة البلاغات وتنبيهات الطوارئ (Reporting and Emergency Alerts)
توضح كيفية التعامل مع البلاغات الطارئة والتحذيرات.
**التسلسل (البلاغات):**
1. **الإرسال**: يضغط السائح على "إبلاغ"، يملأ النموذج ويرسل. يتم رفع الصور المرفقة وحفظ البيانات في جدول Reports بحالة Status = 'New'.
2. **المعالجة**: يتلقى المشرف التنبيه، يغير حالة البلاغ إلى Status = 'In Progress' ويكتب ملاحظة داخلية.
3. **الإغلاق**: عند إتمام المعالجة، يغير المشرف الحالة إلى Status = 'Closed'. يرسل النظام إشعاراً آلياً للسائح المبلغ بإغلاق بلاغه.

**التسلسل (تنبيه الطوارئ):**
1. **إدخال التحذير**: يدخل المشرف نص التحذير ويحدد المنطقة الجغرافية المستهدفة.
2. **تحديد الأجهزة**: يستعلم النظام عن رموز الأجهزة (Device Tokens) للمستخدمين الحاليين الواقعين ضمن النطاق الجغرافي للمنطقة.
3. **الإرسال الفوري**: يتم إرسال إشعار فوري (High Priority Push Notification) عبر خدمة Firebase (FCM) لجميع هذه الأجهزة، مع حفظ سجل للتحذير في جدول Emergency_Alerts.

### 6.3.3 نظام الملاحة والتوجيه (Navigation and Route Guidance)
تفعيل التوجيه الدقيق إلى المعالم.
**التسلسل:**
1. **طلب التوجيه**: يضغط السائح على زر "توجيه".
2. **جلب البيانات**: يقرأ النظام إحداثيات المعلم من جدول Attractions وإحداثيات السائح من GPS جهازه.
3. **التحويل إلى الخرائط**: يقوم النظام بدمج هذه الإحداثيات في رابط مخصص (Intent URI) ويفتح تطبيق الخرائط الخارجي المثبت على جهاز السائح (مثل Google Maps) لتبدأ عملية الملاحة.
4. **عرض حالة الطريق**: يتم عرض قيمة Road_Condition (وعر/معبد) للسائح قبل بدء الرحلة، مع ربطها بتوقعات الطقس الحالية لتوفير تحذير إضافي إذا لزم الأمر.

---

## 4.3 توصيف المتطلبات (Requirements Specification)

### 1.4.3 متطلبات المستخدم (User Requirements)

**أولاً: متطلبات السائح (Tourist Requirements)**
1. إتاحة استعراض المعالم السياحية بتفاصيل غنية (صور عالية الدقة ومقاطع فيديو).
2. معرفة الخدمات والمرافق الحيوية (فنادق، مطاعم، مستشفيات) المحيطة بالمعلم.
3. إمكانية تقييم المعالم وكتابة انطباعاته وتجاربه الشخصية.
4. تحديد الوجهات حسب مديرية المحافظة.
5. توضيح طبيعة الطرق المؤدية للمعالم (معبدة/وعرة).
6. إظهار تصنيف المكان (عائلي/عام).
7. إرشاد السائح إلى أفضل المواسم والأوقات للزيارة.
8. الإبلاغ عن أي مخالفات أو مشاكل في المواقع السياحية.
9. تحديد الموقع الحالي والحصول على توجيه ملاحي دقيق.
10. إنشاء حساب شخصي للاستفادة من الميزات التفاعلية وحفظ المفضلات.
11. عرض حالة الطقس والتوقعات الجوية.
12. تزويد السائح بإرشادات السلامة وأرقام الطوارئ والمناطق الآمنة.
13. التنبيه بمواعيد إغلاق المعالم.
14. توضيح ضوابط التصوير في الأماكن المختلفة.
15. توفير معلومات شاملة عن إجراءات الدخول والتأشيرات.
16. المساعدة في العثور على الخدمات المالية وخدمات الاتصال.
17. مشاركة مسار الرحلة مع الأهل أو الأصدقاء.
18. توفير أدلة إرشادية للمواصلات، الأسواق، المراكز الثقافية، والأكلات الشعبية.
19. إتاحة طلب الاستغاثة الفورية (SOS).

**ثانياً: متطلبات الشريك التجاري (Partner Requirements)**
1. تسجيل حساب تجاري ورفع وثائق الترخيص.
2. طلب تعديل بيانات المنشأة (الصور، الوصف، الموقع).
3. إنشاء وتمويل حملات إعلانية للترويج للخدمات.
4. متابعة حالة الطلبات ومعرفة أسباب الرفض.
5. إدارة وسائل التواصل الخاصة بالمنشأة.
6. الحصول على إحصائيات حول الإقبال والتفاعل.
7. التحكم الفوري في حالة المنشأة (مفتوح/مغلق) وتحديث ساعات العمل.
8. تحديث قائمة الخدمات والمرافق المتوفرة.
9. إضافة عروض وخصومات خاصة.
10. الرد على تقييمات وتعليقات الزوار.
11. تحديث الأسعار.

**ثالثاً: متطلبات مكتب السياحة (Tourism Office Requirements)**
1. إدارة شاملة لبيانات المعالم السياحية (CRUD).
2. إدارة حسابات المستخدمين والشركاء ومراقبة الصلاحيات.
3. لوحة تحكم تعرض مؤشرات أداء وإحصائيات.
4. نشر الفرص الاستثمارية.
5. استقبال بلاغات السياح ومعالجتها.
6. إرسال تعاميم وتحذيرات طوارئ فورية.
7. مراجعة المحتوى وحذف النصوص المسيئة.
8. إنشاء استبيانات لقياس رضا السياح.
9. مراجعة وثائق الشركاء والموافقة عليها.
10. تحديث البيانات المتغيرة مركزياً (مثل أسعار الصرف).
11. توفير سجلات تدقيق (Logs).
12. مراجعة واعتماد الإعلانات التجارية.
13. إدارة اللافتات الإعلانية (Banners).
14. آليات للنسخ الاحتياطي واستعادة البيانات.

### 2.4.3 متطلبات النظام (System Requirements)
*(تم تفصيل متطلبات كل وحدة: السائح، الشريك، ومكتب السياحة في النص الأصلي وتمت أرشفتها بالتفصيل في القسم 3.3)*

---

## 5.3 قاموس المصطلحات (Terminology Dictionary)

| المصطلح (العربية) | المصطلح (English) | التصنيف | التعريف في سياق النظام |
| :--- | :--- | :--- | :--- |
| المعلم السياحي | Attraction | وظيفي | النقطة الأساسية في النظام (موقع أثري، متنزه، معلم ديني) التي يتمحور حولها المحتوى. |
| وحدة السائح | Tourist Module | وظيفي | الجزء من النظام المخصص للمستخدم النهائي (السائح) لتصفح المعالم والخدمات. |
| المرافق/الخدمات | Amenities / Facilities | وظيفي | الميزات الإضافية التي توفرها المنشأة التجارية (واي فاي، موقف سيارات)، وتستخدم في فلترة البحث. |
| الوسم/الشارة | Badge | وظيفي | علامة بصرية صغيرة تظهر بجانب اسم المكان لتوضيح صفة مميزة (مثلاً: "عائلي"). |
| اللافتات الإعلانية | Banners | وظيفي | صور ترويجية تظهر في الجزء العلوي من الصفحة الرئيسية وتدار من قبل المشرفين. |
| زر الاستغاثة | SOS Button | وظيفي | ميزة أمان تتيح للسائح الاتصال الفوري بأرقام الطوارئ. |
| استعلام مكاني | Geospatial Query | تقني | بحث في قاعدة البيانات يعتمد على الموقع الجغرافي (Lat, Long) للعثور على نقاط داخل نطاق محدد. |
| رمز التحقق | OTP | تقني | كلمة مرور مؤقتة تُرسل للتحقق من هوية المستخدم عند التسجيل. |
| العمليات الأربع | CRUD | تقني | اختصار لـ (Create, Read, Update, Delete). |
| الحذف المنطقي | Soft Delete | تقني | "حذف" المعلم بوضع علامة (Flag) تجعله غير مرئي بدلاً من مسحه نهائياً. |
| التقييمات | Reviews | وظيفي | التعليقات والتقييمات النجمية المقدمة من السائحين. |
| سجلات التدقيق | Audit Logs | تقني | تسجيل تفاصيل العمليات الإدارية الحساسة لضمان الأمان. |
| واجهة البرمجة | API | تقني | وسيلة للتواصل مع خدمات خارجية (مثل Weather API). |
| بث الوسائط | Streaming | تقني | عرض الفيديو مباشرة من الخادم دون تحميل الملف كاملاً. |
| نوايا النظام | Intent URI | تقني | آلية لنقل المستخدم من التطبيق إلى تطبيق خرائط خارجي. |
| اعرف عميلك | KYC | وظيفي | إجراءات التحقق من هوية الشركاء التجاريين ووثائقهم الرسمية. |
| حالة الطريق | Road Condition | وظيفي | وصف لطبيعة الطريق (معبد/وعر). |
| إبطال الكاش | Cache Invalidation | تقني | مسح البيانات المؤقتة لإجبار النظام على جلب القيم المحدثة. |

---

## 6.3 نمذجة العمليات (Data Flow)
**1.6.3 المخطط البيئي (Context Diagram):** يمثل حركة البيانات بين الكيانات الخارجية والنظام.
**2.6.3 مخطط العمليات (UML):** يشمل مخططات الأنشطة (Activity Diagrams) وحالات الاستخدام (Use Cases).

---

## 7.3 نمذجة البيانات (Process Modeling)
**1.7.3 مخطط الكينونة والعلاقة (ERD):** يوضح العلاقات بين الجداول (المستخدمين، المعالم، التقييمات، إلخ).

## 8.3 جداول قاعدة البيانات (Database Tables)
يرتبط النظام بقاعدة بيانات علائقية تتكون من جداول مترابطة لخدمة الوظائف المذكورة أعلاه.
