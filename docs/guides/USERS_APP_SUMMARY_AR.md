# ๐ ููุฎุต ุชูุซูู ุชุทุจูู ุงููุณุชุฎุฏููู (users)

> **Users App Documentation Summary**
>
> ุฏููู ุฅุจ ุงูุณูุงุญู - Ibb Tourist Guide

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชุทุจูู **ุงููุณุชุฎุฏููู** ูู ุงูุชุทุจูู ุงูุฃุณุงุณู ุงููุณุคูู ุนู:

- ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ุงููุณุชุฎุฏููู
- ุงููุตุงุฏูุฉ ูุชุณุฌูู ุงูุฏุฎูู
- ูุธุงู ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช
- ุฅุฏุงุฑุฉ ุงูุดุฑูุงุก ุงูุชุฌุงุฑููู

---

## ๐ ูููู ุงููููุงุช

```
users/
โโโ models.py           # ุงูููุงุฐุฌ ููุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ views.py            # ุงูุนุฑูุถ ุงูุฑุฆูุณูุฉ
โโโ views_partner.py    # ุนุฑูุถ ุงูุดุฑูู
โโโ views_auth.py       # ุนุฑูุถ ุงููุตุงุฏูุฉ
โโโ forms.py            # ููุงุฐุฌ ุงูุฅุฏุฎุงู ุงูุนุงูุฉ
โโโ forms_auth.py       # ููุงุฐุฌ ุงููุตุงุฏูุฉ
โโโ forms_login.py      # ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู
โโโ admin.py            # ููุญุฉ ุงูุฅุฏุงุฑุฉ
โโโ email_service.py    # ุฎุฏูุฉ ุงูุจุฑูุฏ
โโโ signals.py          # ุงูุฅุดุงุฑุงุช
โโโ mixins.py           # ุฎูุทุงุช ุงูุตูุงุญูุงุช
โโโ backends.py         # ูุธุงู ุงููุตุงุฏูุฉ
โโโ serializers.py      # ูุญููุงุช API
โโโ urls.py             # ุงููุณุงุฑุงุช
```

---

## ๐๏ธ ุงูููุงุฐุฌ (Models)

### 1. User - ุงููุณุชุฎุฏู ุงูุฑุฆูุณู

```python
class User(AbstractUser):
    """ุงููุณุชุฎุฏู ุงูุฑุฆูุณู - ูุฑุซ ูู AbstractUser"""
```

| ุงูุญูู            | ุงูููุน      | ุงููุตู                    |
| ---------------- | ---------- | ------------------------ |
| `username`       | CharField  | ุงุณู ุงููุณุชุฎุฏู (ูุฑูุฏ)      |
| `email`          | EmailField | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูุฑูุฏ) |
| `full_name`      | CharField  | ุงูุงุณู ุงููุงูู             |
| `phone_number`   | CharField  | ุฑูู ุงููุงุชู               |
| `profile_image`  | ImageField | ุตูุฑุฉ ุงูููู ุงูุดุฎุตู        |
| `cover_image`    | ImageField | ุตูุฑุฉ ุงูุบูุงู              |
| `bio`            | TextField  | ุงููุจุฐุฉ ุงูุชุนุฑูููุฉ         |
| `role`           | ForeignKey | ุงูุฏูุฑ (Role)             |
| `account_status` | CharField  | ุญุงูุฉ ุงูุญุณุงุจ              |
| `interests`      | ManyToMany | ุงูุงูุชูุงูุงุช               |
| `job_positions`  | ManyToMany | ุงูููุงุตุจ                  |
| `fcm_token`      | TextField  | ุฑูุฒ ุงูุฅุดุนุงุฑุงุช            |

**ุญุงูุงุช ุงูุญุณุงุจ:**

- `active` - ูุดุท
- `pending` - ููุฏ ุงููุฑุงุฌุนุฉ
- `rejected` - ูุฑููุถ
- `suspended` - ููููู

---

### 2. PartnerProfile - ููู ุงูุดุฑูู

```python
class PartnerProfile(TimeStampedModel):
    """ููู ุงูุดุฑูู ุงูุชุฌุงุฑู - ุนูุงูุฉ OneToOne ูุน User"""
```

| ุงูุญูู                      | ุงูููุน      | ุงููุตู             |
| -------------------------- | ---------- | ----------------- |
| `user`                     | OneToOne   | ุงููุณุชุฎุฏู          |
| `organization_name`        | CharField  | ุงุณู ุงูููุธูุฉ       |
| `commercial_reg_no`        | CharField  | ุฑูู ุงูุณุฌู ุงูุชุฌุงุฑู |
| `id_card_image`            | ImageField | ุตูุฑุฉ ุงููููุฉ       |
| `commercial_registry_file` | FileField  | ููู ุงูุณุฌู ุงูุชุฌุงุฑู |
| `status`                   | CharField  | ุญุงูุฉ ุงูุทูุจ        |
| `is_approved`              | Boolean    | ููุงูู ุนููู        |
| `rejection_reason`         | TextField  | ุณุจุจ ุงูุฑูุถ         |
| `reviewed_by`              | ForeignKey | ุงููุฑุงุฌุน           |

**ุญุงูุงุช ุงูุทูุจ:**

- `pending` - ููุฏ ุงููุฑุงุฌุนุฉ
- `approved` - ููุงูู ุนููู
- `rejected` - ูุฑููุถ
- `info_requested` - ุทูุจ ูุนูููุงุช

---

### 3. Role - ุงูุฃุฏูุงุฑ

```python
class Role(models.Model):
    """ุงูุฃุฏูุงุฑ ูุงูุตูุงุญูุงุช"""
```

| ุงูุญูู         | ุงูููุน      | ุงููุตู     |
| ------------- | ---------- | --------- |
| `name`        | CharField  | ุงุณู ุงูุฏูุฑ |
| `description` | TextField  | ุงููุตู     |
| `permissions` | ManyToMany | ุงูุตูุงุญูุงุช |

**ุงูุฃุฏูุงุฑ ุงูุงูุชุฑุงุถูุฉ:**

- ุณุงุฆุญ (Tourist)
- ุดุฑูู (Partner)
- ููุชุจ ุณูุงุญู (Tourism Office)
- ูุฏูุฑ (Admin)

---

### 4. ููุงุฐุฌ ูุณุงุนุฏุฉ

| ุงููููุฐุฌ               | ุงููุตู               |
| --------------------- | ------------------- |
| `Interest`            | ุงูุชูุงูุงุช ุงููุณุชุฎุฏููู |
| `JobPosition`         | ุงูููุงุตุจ ุงููุธูููุฉ    |
| `UserRegistrationLog` | ุณุฌู ุงูุชุณุฌููุงุช       |
| `UserLoginLog`        | ุณุฌู ุชุณุฌููุงุช ุงูุฏุฎูู  |

---

## ๐ ุงูุนุฑูุถ (Views)

### ุนุฑูุถ ุงูุชุณุฌูู ูุงููุตุงุฏูุฉ

| ุงูุนุฑุถ               | ุงููุธููุฉ         | URL                 |
| ------------------- | --------------- | ------------------- |
| `VisitorSignUpView` | ุชุณุฌูู ุฒุงุฆุฑ ุฌุฏูุฏ | `/signup/`          |
| `PartnerSignUpView` | ุชุณุฌูู ุดุฑูู ุฌุฏูุฏ | `/partners/signup/` |
| `UnifiedLoginView`  | ุชุณุฌูู ุงูุฏุฎูู    | `/login/`           |
| `LogoutView`        | ุชุณุฌูู ุงูุฎุฑูุฌ    | `/logout/`          |

### ุนุฑูุถ ุงูุชุญูู ูู ุงูุฅูููู

| ุงูุนุฑุถ                    | ุงููุธููุฉ           | URL                     |
| ------------------------ | ----------------- | ----------------------- |
| `VerificationSentView`   | ุตูุญุฉ "ุชู ุงูุฅุฑุณุงู" | `/verification-sent/`   |
| `EmailVerificationView`  | ุงูุชุญูู ูู ุงูุฑุงุจุท  | `/verify/<token>/`      |
| `ResendVerificationView` | ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู     | `/resend-verification/` |

### ุนุฑูุถ ุงูููู ุงูุดุฎุตู

| ุงูุนุฑุถ             | ุงููุธููุฉ         | URL          |
| ----------------- | --------------- | ------------ |
| `UserProfileView` | ุนุฑุถ/ุชุนุฏูู ุงูููู | `/profile/`  |
| `SettingsView`    | ุงูุฅุนุฏุงุฏุงุช       | `/settings/` |

### ุนุฑูุถ ุงูุดุฑูู

| ุงูุนุฑุถ                         | ุงููุธููุฉ          | URL                       |
| ----------------------------- | ---------------- | ------------------------- |
| `PartnerProfileUpdateView`    | ุชุญุฏูุซ ููู ุงูุดุฑูู | `/partners/profile/edit/` |
| `PartnerPendingView`          | ุญุงูุฉ ุงูุทูุจ       | `/partners/pending/`      |
| `TouristToPartnerUpgradeView` | ุงูุชุฑููุฉ ูุดุฑูู    | `/partners/upgrade/`      |

---

## ๐ ุงูููุงุฐุฌ (Forms)

| ุงููููุฐุฌ              | ุงููุธููุฉ      | ุงูููู          |
| -------------------- | ------------ | -------------- |
| `VisitorSignUpForm`  | ุชุณุฌูู ุฒุงุฆุฑ   | forms.py       |
| `PartnerSignUpForm`  | ุชุณุฌูู ุดุฑูู   | forms_auth.py  |
| `TouristUpgradeForm` | ุชุฑููุฉ ูุดุฑูู  | forms_auth.py  |
| `UserUpdateForm`     | ุชุญุฏูุซ ุงูููู  | forms.py       |
| `PartnerProfileForm` | ููู ุงูุดุฑูู   | forms.py       |
| `UnifiedLoginForm`   | ุชุณุฌูู ุงูุฏุฎูู | forms_login.py |

---

## ๐ ูุธุงู ุงููุตุงุฏูุฉ

### backends.py - ุงููุตุงุฏูุฉ ุงููุฎุตุตุฉ

```python
class EmailOrUsernameModelBackend:
    """ูุณูุญ ุจุชุณุฌูู ุงูุฏุฎูู ุจุงูุฅูููู ุฃู ุงุณู ุงููุณุชุฎุฏู"""
```

**ุงูููุฒุงุช:**

- ุชุณุฌูู ุฏุฎูู ุจู username ุฃู email
- ุงูุชุญูู ูู ุญุงูุฉ ุงูุญุณุงุจ
- Rate Limiting ุถุฏ ูุฌูุงุช Brute Force

---

## ๐ง ุฎุฏูุฉ ุงูุจุฑูุฏ (email_service.py)

| ุงูุฏุงูุฉ                                     | ุงููุธููุฉ                        |
| ------------------------------------------ | ------------------------------ |
| `generate_verification_token()`            | ุชูููุฏ ุฑูุฒ ุชุญูู ุขูู (64 ุญุฑู)    |
| `send_verification_email(user, request)`   | ุฅุฑุณุงู ุฅูููู ุงูุชุญูู             |
| `resend_verification_email(user, request)` | ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ูุน Rate Limiting |

**ุณูุฑ ุงูุนูู:**

```
ุชุณุฌูู โ ุชูููุฏ ุฑูุฒ โ ุฅุฑุณุงู ุฅูููู โ ุงููุณุชุฎุฏู ูุถุบุท ุงูุฑุงุจุท โ ุชูุนูู ุงูุญุณุงุจ
```

---

## ๐ ุงูุฅุดุงุฑุงุช (signals.py)

| ุงูุฅุดุงุฑุฉ                   | ุงูุญุฏุซ              | ุงูุฅุฌุฑุงุก                       |
| ------------------------- | ------------------ | ----------------------------- |
| `sync_user_role_to_group` | post_save ุนูู User | ูุฒุงููุฉ ุงูุฏูุฑ ูุน Django Groups |

---

## ๐ก๏ธ ุฎูุทุงุช ุงูุตูุงุญูุงุช (mixins.py)

| ุงูุฎูุทุฉ                         | ุงููุธููุฉ                          |
| ------------------------------ | -------------------------------- |
| `RbacPermissionRequiredMixin`  | ุงูุชุญูู ูู ุตูุงุญูุฉ ูุนููุฉ           |
| `ApprovedPartnerRequiredMixin` | ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ุดุฑูู ูุนุชูุฏ |

**ูุซุงู ุงูุงุณุชุฎุฏุงู:**

```python
class PartnerDashboardView(ApprovedPartnerRequiredMixin, TemplateView):
    template_name = 'partners/dashboard.html'
```

---

## ๐ฅ๏ธ ููุญุฉ ุงูุฅุฏุงุฑุฉ (admin.py)

### CustomUserAdmin

- ุนุฑุถ: username, full_name, role, status
- ุฅุฌุฑุงุกุงุช: ุชูุนููุ ุฅูุบุงุก ุงูุชูุนููุ ุฌุนูู staff
- ุดุงุฑุงุช ููููุฉ ููุญุงูุงุช
- ุงุณุชูุฑุงุฏ CSV

### PartnerProfileAdmin

- ุนุฑุถ: user, commercial_reg, status
- ุฅุฌุฑุงุกุงุช: ููุงููุฉุ ุฑูุถุ ุญุธุฑ
- ุนุฏุฏ ุงูููุดุขุช

---

## ๐ ุงูุนูุงูุงุช

```
โโโโโโโโโโโโโโโ
โ    Role     โ
โโโโโโโโฌโโโโโโโ
       โ 1:N
       โผ
โโโโโโโโโโโโโโโ      1:1      โโโโโโโโโโโโโโโโโโโ
โ    User     โโโโโโโโโโโโโโโโบโ  PartnerProfile โ
โโโโโโโโโโโโโโโ               โโโโโโโโโโโโโโโโโโโ
       โ
       โ M:N
       โผ
โโโโโโโโโโโโโโโ
โ  Interest   โ
โ JobPosition โ
โโโโโโโโโโโโโโโ
```

---

## ๐ ุณูุฑ ุงูุนูู ุงูุฑุฆูุณู

### 1. ุชุณุฌูู ุฒุงุฆุฑ ุฌุฏูุฏ

```
ููุก ุงูููุฑู โ ุฅูุดุงุก User โ ุฅุฑุณุงู ุฅูููู ุชุญูู โ ุชูุนูู ุงูุญุณุงุจ
```

### 2. ุชุณุฌูู ุดุฑูู ุฌุฏูุฏ

```
ููุก ููุฑู ุงูุดุฑูู โ ุฅูุดุงุก User + PartnerProfile โ
ุงูุชุธุงุฑ ุงูููุงููุฉ โ ููุงููุฉ ุงูุฃุฏูู โ ุญุณุงุจ ุดุฑูู ูุดุท
```

### 3. ุชุฑููุฉ ุณุงุฆุญ ูุดุฑูู

```
ุณุงุฆุญ ูุดุท โ ุชูุฏูู ุทูุจ ุชุฑููุฉ โ ุฅูุดุงุก PartnerProfile โ
ุงูุชุธุงุฑ ุงูููุงููุฉ โ ููุงููุฉ ุงูุฃุฏูู โ ุชุบููุฑ ุงูุฏูุฑ
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุญูู ูู ุงูุฅูููู** ุฅูุฒุงูู ูุชูุนูู ุงูุญุณุงุจ
2. **Rate Limiting** ููุนู ุนูู:
   - ุชุณุฌูู ุงูุฏุฎูู (5 ูุญุงููุงุช/ุฏูููุฉ)
   - ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุชุญูู (3 ูุฑุงุช/ุณุงุนุฉ)
3. **ุงูุดุฑูู** ูุญุชุงุฌ ููุงููุฉ ุฃุฏูู ูุจู ุงูุชูุนูู
4. **ูููุฉ ุงููุฑูุฑ** ูุฌุจ ุฃู ุชููู 8 ุฃุญุฑู ุนูู ุงูุฃูู

---

> **ุชุงุฑูุฎ ุงูุชูุซูู**: 2026-02-09
