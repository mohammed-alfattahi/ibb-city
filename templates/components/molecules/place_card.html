{# Molecule: Place Card #}
{% load static %}

<div class="card card-hoverable h-100 border-0 shadow-sm overflow-hidden {{ class }}">
    <!-- Image Wrapper -->
    <div class="position-relative" style="height: 220px;">
        <img src="{% if place.cover_image %}{{ place.cover_image.url }}{% else %}https://images.unsplash.com/photo-1596423497886-f1262d46e387?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80{% endif %}"
            class="w-100 h-100 object-fit-cover transition-transform duration-500 hover:scale-110"
            alt="{{ place.name }}"
            onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1596423497886-f1262d46e387?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&q=80';">

        <!-- Category Badge -->
        <span
            class="position-absolute top-0 start-0 m-3 badge bg-white text-dark shadow-sm bg-opacity-75 backdrop-blur-md rounded-pill">
            {{ place.category.name|default:"عام" }}
        </span>

        <!-- Rating Badge -->
        <div
            class="position-absolute bottom-0 end-0 m-3 badge bg-white text-dark shadow-sm rounded-pill d-flex align-items-center gap-1">
            <i class="fas fa-star text-warning"></i>
            <span class="fw-bold">{{ place.avg_rating|default:"0" }}</span>
            <span class="text-muted fw-normal small">({{ place.reviews.count }})</span>
        </div>
    </div>

    <!-- Card Body -->
    <div class="card-body d-flex flex-column p-4">
        <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title fw-bold mb-0">
                <a href="{% url 'place_detail' place.pk %}"
                    class="text-decoration-none text-dark hover:text-primary transition-colors">
                    {{ place.name }}
                </a>
            </h5>
            {% if place.establishment and place.establishment.is_badged %}
            <span class="badge bg-success rounded-pill px-2 py-1 small" data-bs-toggle="tooltip" title="منشأة تم التحقق منها">
                <i class="fas fa-check-circle me-1"></i>موثقة
            </span>
            {% endif %}
        </div>

        <div class="text-muted small mb-3">
            <i class="fas fa-map-marker-alt text-danger me-1"></i>
            {{ place.directorate|default:"إب" }}
        </div>

        <p class="card-text text-muted small flex-grow-1 mb-4 line-clamp-2">
            {{ place.description|truncatechars:100|default:"اكتشف هذا المكان المميز في محافظة إب..." }}
        </p>

        <div class="d-flex gap-2 mt-auto">
            <a href="{% url 'place_detail' place.pk %}" class="btn btn-sm btn-primary rounded-pill px-4 flex-grow-1">
                التفاصيل
            </a>
            <button class="btn btn-sm btn-light btn-icon rounded-circle favorite-btn border" data-id="{{ place.pk }}">
                <i class="far fa-heart"></i>
            </button>
        </div>
    </div>
</div>