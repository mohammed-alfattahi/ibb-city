{% extends "partners/base_partner.html" %}
{% load static %}

{% block title %}إدارة المنشآت - شريك إب{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h4 class="fw-bold mb-1">إدارة المنشآت</h4>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 small">
                <li class="breadcrumb-item"><a href="{% url 'partner_dashboard' %}"
                        class="text-decoration-none">الرئيسية</a></li>
                <li class="breadcrumb-item active">المنشآت</li>
            </ol>
        </nav>
    </div>
    <a href="{% url 'wizard_start' %}" class="btn btn-success d-flex align-items-center gap-2 shadow-sm">
        <i class="fas fa-plus-circle"></i>
        <span>منشأة جديدة</span>
    </a>
</div>

{% if drafts %}
<div class="alert alert-warning border-start border-5 border-warning d-flex align-items-center mb-4 shadow-sm"
    role="alert">
    <i class="fas fa-exclamation-triangle fa-2x me-3 opacity-50"></i>
    <div class="flex-grow-1">
        <h6 class="alert-heading fw-bold mb-1">مسودات غير مكتملة</h6>
        <p class="mb-0 small">لديك {{ drafts|length }} منشأة قيد الإنشاء. استكمل البيانات لنشرها.</p>
    </div>
    <div>
        {% for draft in drafts %}
        <a href="{% url 'wizard_step' draft.pk draft.current_step %}" class="btn btn-warning btn-sm fw-bold">
            متابعة {{ draft.establishment.name|default:"مسودة" }}
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="ent-card">
    <div class="ent-card-header">
        <span><i class="fas fa-list me-2"></i> قائمة المنشآت</span>
        <div class="input-group input-group-sm w-auto">
            <input type="text" class="form-control" placeholder="بحث...">
            <button class="btn btn-outline-light bg-white text-primary" type="button"><i
                    class="fas fa-search"></i></button>
        </div>
    </div>
    <div class="ent-card-body p-0 table-responsive">
        <table class="table table-striped table-hover align-middle mb-0 text-center">
            <thead class="bg-light">
                <tr>
                    <th class="py-3">#</th>
                    <th class="py-3" style="width: 80px;">الصورة</th>
                    <th class="py-3 text-start">المنشأة</th>
                    <th class="py-3">الحالة</th>
                    <th class="py-3">الترخيص</th>
                    <th class="py-3">التقييم</th>
                    <th class="py-3">الزيارات</th>
                    <th class="py-3">الإجراءات</th>
                </tr>
            </thead>
            <tbody>
                {% for place in establishments %}
                    {% include "places/partials/partner_establishment_row.html" %}
                {% empty %}
                <tr>
                    <td colspan="8" class="py-5 text-center">
                        <div class="py-4">
                            <div class="d-inline-flex bg-light rounded-circle p-4 mb-3">
                                <i class="fas fa-store-slash fa-3x text-muted opacity-50"></i>
                            </div>
                            <h5 class="fw-bold text-dark mb-2">لا توجد منشآت مسجلة حتى الآن</h5>
                            <p class="text-muted mb-4 mx-auto" style="max-width: 400px;">
                                لم تقم بإضافة أي منشأة سياحية. ابدأ الآن بإضافة منشأتك الأولى لتظهر في الدليل وتصل للزوار.
                            </p>
                            <a href="{% url 'wizard_start' %}" class="btn btn-primary rounded-pill px-4 shadow-sm hover-up">
                                <i class="fas fa-plus-circle me-2"></i> إضافة منشأة جديدة
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="card-footer bg-white py-3">
        <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm justify-content-center mb-0">
                <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1">السابق</a></li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">التالي</a></li>
            </ul>
        </nav>
    </div>
</div>

<script>
    document.body.addEventListener('htmx:configRequest', function(evt) {
        evt.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
    });
</script>
{% endblock %}