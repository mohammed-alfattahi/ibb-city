{% extends "base_marketing.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}الفنادق والاستراحات - دليل إب{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/modern_list.css' %}">
<style>
    /* Hero Banner */
    .hero-banner {
        height: 350px;
        border-radius: 0 0 40px 40px;
        overflow: hidden;
        position: relative;
    }

    .hero-banner img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .hero-overlay {
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.7) 100%);
    }

    /* Top Filter Bar */
    .filter-bar {
        background: white;
        border-radius: 20px;
        padding: 20px 24px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-top: -60px;
        position: relative;
        z-index: 20;
    }

    .filter-bar .form-control,
    .filter-bar .form-select {
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        padding: 12px 16px;
        font-size: 14px;
    }

    .filter-bar .form-control:focus,
    .filter-bar .form-select:focus {
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .filter-btn {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border: none;
        border-radius: 12px;
        padding: 12px 28px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    /* Place Cards */
    .place-card {
        border-radius: 20px !important;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: none !important;
    }

    .place-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15) !important;
    }

    .place-card .card-img-wrapper {
        height: 200px;
        overflow: hidden;
    }

    .place-card .card-img-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .place-card:hover .card-img-wrapper img {
        transform: scale(1.1);
    }

    /* Pagination */
    .modern-pagination .page-link {
        border: none;
        border-radius: 12px;
        padding: 10px 18px;
        margin: 0 4px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .modern-pagination .page-item.active .page-link {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }

    .modern-pagination .page-link:hover:not(.active) {
        background: #f1f5f9;
        color: #10b981;
    }

    /* Smooth Page Transitions */
    .fade-in {
        animation: fadeInUp 0.6s ease-out;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Cards stagger animation */
    .place-card:nth-child(1) {
        animation-delay: 0.1s;
    }

    .place-card:nth-child(2) {
        animation-delay: 0.2s;
    }

    .place-card:nth-child(3) {
        animation-delay: 0.3s;
    }

    .place-card:nth-child(4) {
        animation-delay: 0.4s;
    }

    .place-card:nth-child(5) {
        animation-delay: 0.5s;
    }

    .place-card:nth-child(6) {
        animation-delay: 0.6s;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Banner -->
<div class="hero-banner shadow-lg mb-0">
    {% if page_config.hero_image %}
    <img src="{{ page_config.hero_image.url }}" alt="{{ page_config.hero_title }}">
    {% else %}
    <img src="https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80"
        alt="Hotels">
    {% endif %}
    <div
        class="hero-overlay position-absolute top-0 start-0 w-100 h-100 d-flex flex-column align-items-center justify-content-center text-center p-4">
        <h1 class="text-white display-4 fw-bold mb-3 animate__animated animate__fadeInDown"
            style="text-shadow: 0 4px 15px rgba(0,0,0,0.5);">
            {{ page_config.hero_title|default:"استكشف الأماكن" }}
        </h1>
        {% if page_config.hero_subtitle %}
        <p class="text-white fs-5 opacity-90 animate__animated animate__fadeInUp fw-light">
            {{ page_config.hero_subtitle }}
        </p>
        {% endif %}
    </div>
</div>

<div class="container" style="max-width: 1200px;">
    <!-- Top Filter Bar -->
    <div class="filter-bar mb-5 animate__animated animate__fadeInUp">
        <form method="get" class="row g-3 align-items-end"
              hx-get="."
              hx-target="#places-results"
              hx-push-url="true"
              hx-indicator="#global-loading, #places-results"
              hx-trigger="keyup changed delay:300ms from:input, change, submit">
            
            <!-- Search -->
            <div class="col-md-3">
                <label class="form-label small fw-bold text-muted">البحث</label>
                <div class="input-group">
                    <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                    <input type="text" name="q" class="form-control border-start-0 ps-0" 
                        placeholder="ابحث بالاسم..."
                        value="{{ request.GET.q }}">
                </div>
            </div>

            <!-- Category -->
            <div class="col-md-2">
                <label class="form-label small fw-bold text-muted">التصنيف</label>
                <select name="category" class="form-select">
                    <option value="">الكل</option>
                    {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- City/Directorate -->
            <div class="col-md-2">
                <label class="form-label small fw-bold text-muted">المديرية</label>
                <select name="city" class="form-select">
                    <option value="">الكل</option>
                    {% for code, label in directorate_choices %}
                    <option value="{{ code }}" {% if request.GET.city == code %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- More Filters Button (Collapse) -->
             <div class="col-md-2">
                 <label class="form-label small fw-bold text-muted">خيارات إضافية</label>
                <button class="btn btn-outline-secondary w-100 dropdown-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters" aria-expanded="false">
                    <i class="fas fa-sliders-h me-1"></i> فلترة
                </button>
            </div>

            <!-- Sort -->
            <div class="col-md-2">
                <label class="form-label small fw-bold text-muted">ترتيب حسب</label>
                <select name="sort" class="form-select">
                    <option value="latest" {% if request.GET.sort == "latest" %}selected{% endif %}>الأحدث</option>
                    <option value="top_rated" {% if request.GET.sort == "top_rated" %}selected{% endif %}>الأعلى تقييماً</option>
                    <option value="most_viewed" {% if request.GET.sort == "most_viewed" %}selected{% endif %}>الأكثر مشاهدة</option>
                </select>
            </div>

            <!-- Reset -->
            <div class="col-md-1 d-flex gap-2">
                <a href="{{ request.path }}" class="btn btn-light border flex-grow-1" style="border-radius: 12px;" title="إعادة تعيين">
                    <i class="fas fa-undo"></i>
                </a>
            </div>

            <!-- Advanced Filters Row -->
            <div class="col-12 collapse mt-3" id="advancedFilters">
                <div class="card card-body bg-light border-0 rounded-4">
                    <div class="row g-3">
                        <!-- Rating -->
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-muted">التقييم</label>
                            <select name="min_rating" class="form-select">
                                <option value="">الكل</option>
                                <option value="3" {% if request.GET.min_rating == "3" %}selected{% endif %}>3+ نجوم</option>
                                <option value="4" {% if request.GET.min_rating == "4" %}selected{% endif %}>4+ نجوم</option>
                                <option value="4.5" {% if request.GET.min_rating == "4.5" %}selected{% endif %}>4.5+ نجوم</option>
                                <option value="5" {% if request.GET.min_rating == "5" %}selected{% endif %}>5 نجوم</option>
                            </select>
                        </div>
                        
                        <!-- Classification -->
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-muted">تصنيف المكان</label>
                            <select name="classification" class="form-select">
                                <option value="">الكل</option>
                                {% for code, label in classification_choices %}
                                <option value="{{ code }}" {% if request.GET.classification == code %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Road Condition -->
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-muted">حالة الطريق</label>
                            <select name="road_condition" class="form-select">
                                <option value="">الكل</option>
                                {% for code, label in road_choices %}
                                <option value="{{ code }}" {% if request.GET.road_condition == code %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Banner Ad Placement (Lazy Loaded) -->
    <div class="mb-5"
         hx-get="{% url 'ad_slot' 'banner' %}"
         hx-trigger="load"
         hx-swap="innerHTML"></div>

    <!-- Results Container (Updated via HTMX) -->
    <div class="position-relative">
        <div id="places-results" class="transition-fade">
            {% include "places/partials/place_list_results.html" %}
        </div>
    </div>
</div>

<!-- Smooth Scroll & Animations -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Intersection Observer for fade-in animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.fade-in').forEach((el) => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'all 0.6s ease-out';
            observer.observe(el);
        });

        // Smooth scroll for all anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    });
</script>
{% endblock %}
