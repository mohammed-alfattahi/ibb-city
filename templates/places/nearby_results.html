{% load static %}
{% load i18n %}

{% if nearby_places %}
<div class="row g-3">
    {% for place in nearby_places %}
    <div class="col-6 col-md-4 col-lg-3">
        <div class="card border-0 shadow-sm h-100 rounded-4 overflow-hidden hover-lift nearby-card">
            <!-- Image -->
            <div class="position-relative" style="height: 120px;">
                {% if place.cover_image %}
                <img src="{{ place.cover_image.url }}" class="w-100 h-100 object-fit-cover" alt="{{ place.name }}">
                {% else %}
                <img src="{% static 'images/placeholder.jpg' %}" class="w-100 h-100 object-fit-cover"
                    alt="{{ place.name }}">
                {% endif %}
                <!-- Distance Badge -->
                {% if place.exact_distance_km is not None %}
                <div class="position-absolute top-0 end-0 m-2 d-flex flex-column gap-1 align-items-end">
                    <span class="badge bg-dark bg-opacity-75 backdrop-blur rounded-pill py-1 px-2 small">
                        <i class="fas fa-location-arrow me-1 fa-xs"></i>{{ place.exact_distance_km|floatformat:1 }} km
                    </span>
                    <!-- HTMX Favorite Button -->
                    <div id="fav-btn-wrap-{{ place.id }}">
                        {% include "partials/favorite_button.html" with is_fav=place.is_favorited %}
                    </div>
                </div>
                {% else %}
                <div class="position-absolute top-0 end-0 m-2">
                    <div id="fav-btn-wrap-{{ place.id }}">
                        {% include "partials/favorite_button.html" with is_fav=place.is_favorited %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Content -->
            <div class="card-body p-3">
                <h6 class="fw-bold mb-1 text-truncate">{{ place.name }}</h6>
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="text-secondary text-truncate" style="max-width: 70%;">
                        {% if place.category %}
                        <i class="fas fa-tag me-1 text-primary"></i>{{ place.category.name }}
                        {% else %}
                        <i class="fas fa-map-marker-alt me-1 text-muted"></i>Place
                        {% endif %}
                    </small>
                    <small class="text-warning fw-bold">
                        <i class="fas fa-star fa-xs"></i> {{ place.avg_rating|default:"-" }}
                    </small>
                </div>

                <!-- Action -->
                <a href="{{ place.get_absolute_url }}" class="btn btn-outline-primary btn-sm w-100 rounded-pill py-1"
                    style="font-size: 0.8rem;">
                    {% trans "View Details" %}
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-4 text-muted">
    <i class="fas fa-map-signs fa-2x mb-2 text-secondary opacity-50"></i>
    <p class="small mb-0">{% trans "No nearby places found within 20km." %}</p>
</div>
{% endif %}

<style>
    .nearby-card .card-body {
        background: #fff;
    }

    .hover-lift:hover {
        transform: translateY(-3px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1) !important;
    }
</style>